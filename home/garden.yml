kind: Module
type: container
name: home
description: home page
services:
  - name: home
    ports:
      - name: http
        containerPort: 80
        servicePort: 80
    ingresses:
      - path: /
        port: http
        hostname: home.${variables.base-hostname}
    devMode:
      sync:
        - target: /usr/share/nginx/html/
          source: src
          defaultFileMode: 0444
    dependencies:
      - home-secrets
      - onedev
tasks:
  - name: npm-install
    command: [npm, install]
    dependencies:
      - home
  - name: sync-sites
    command: [npm, run, sync-sites]
    env:
      GIT_USERNAME:
        secretRef:
          name: git-credentials
          key: username
      GIT_PASSWORD:
        secretRef:
          name: git-credentials
          key: password
tests:
  - name: npm-audit
    command: [npm, audit]
    dependencies:
      - npm-install
